<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="admin.shop.ProductDAO">

	<insert id="insertProduct" parameterType="productdto">
		<!-- product_id / pet_type / category / product_num / reg_date -->
		<!-- product_name / price / quatity / image_main / image_detail -->
		insert into products(
		product_id,pet_type,category,product_num,reg_date,
		product_name,price,quatity,image_main,image_detail
		)
		values(
		#{product_id},#{pet_type},#{category},#{product_num},#{reg_date},
		#{product_name},#{price},#{quatity},#{image_main},#{image_detail}
		)
	</insert>

	<select id="maxProductNum" resultType="int">
		select max(product_num)
		from products;
	</select>

	<select id="countTotalProductNum" resultType="int">
		select count(*)
		from products;
	</select>

	<select id="getAllProduct" resultType="productdto">
		select * from products
		where isvisible=true order by product_num;
	</select>

	<select id="getAllByPetType" resultType="productdto"
		parameterType="String">
		select * from products where pet_type=#{pet} and
		isvisible=true order by product_num;
	</select>
	
	<delete id="deleteProduct" parameterType="String">
		delete from products where product_id = #{product_id};
	</delete>
	
	<!-- ▼▼▼▼Pagination▼▼▼▼ -->
	<select id="getAllProductPaging" resultType="productdto"
		parameterType="pagination.SearchDTO">
		select *
		from products
		<choose>
			<!-- 검색어가 있을때 -->
			<when test="keyword != null and keyword != ''">
				<choose>
					<!-- 카테고리1값이 '전체'이거나 공백일때 -->
					<when test="'전체'.equals( searchType1 ) or searchType1 == null or searchType1 == ''">
						<choose>
							<!-- 카테고리2값이 '전체'or 공백일때 -->
							<when test="'전체'.equals( searchType2 ) or searchType2 == null or searchType2 == ''">
								where product_name LIKE CONCAT('%', #{keyword}, '%')
							</when>

							<!-- 카테고리2값이 '전체'아닐때 -->
							<otherwise>
								where
								category = #{searchType2}
								and product_name LIKE CONCAT('%', #{keyword}, '%')
							</otherwise>
						</choose>
					</when>
					
					<!-- 카테고리1값이 '전체' 아닐때 -->
					<otherwise>
						<choose>
							<!-- 카테고리2값이 '전체'or 공백일때 -->
							<when test="'전체'.equals( searchType2 ) or searchType2 == null or searchType2 == ''">
								where
								pet_type = #{searchType1}
								and product_name LIKE CONCAT('%', #{keyword}, '%')
							</when>

							<!-- 카테고리2값이 '전체'아닐때 -->
							<otherwise>
								where
								category = #{searchType2}
								and pet_type = #{searchType1}
								and product_name LIKE CONCAT('%', #{keyword}, '%')
							</otherwise>
						</choose>
					</otherwise>
				</choose>
			</when>

			<!-- 검색어 없을때 -->
			<otherwise>
				<choose>
					<!-- 카테고리1값이 '전체'일때 -->
					<when test="'전체'.equals( searchType1 ) or searchType1 == null or searchType1 == ''">
						<choose>
							<!-- 카테고리2값이 '전체'일때 -->
							<when test="'전체'.equals( searchType2 ) or searchType2 == null or searchType2 == ''">
							</when>

							<!-- 카테고리2값이 '전체' 아닐때 -->
							<otherwise>
								where
								category = #{searchType2}							
							</otherwise>
						</choose>
					</when>

					<!-- 카테고리1값이 '전체' 아닐때 -->
					<otherwise>
						<choose>
							<!-- 카테고리2값이 '전체' 아닐때 -->
							<when test="'전체'.equals( searchType2 ) or searchType2 == null or searchType2 == ''">
								where
								pet_type = #{searchType1}
							</when>

							<!-- 카테고리2값이 '전체'일때 -->
							<otherwise>
								where
								category = #{searchType2}
								and pet_type = #{searchType1}
							</otherwise>
						</choose>
					</otherwise>
				</choose>
			</otherwise>
		</choose>
		order by product_num
		limit #{pagination.limitStart}, #{recordSize}
	</select>

	<select id="getCount" resultType="int"
		parameterType="pagination.SearchDTO">
		select count(*)
		from products
		<choose>
			<!-- 검색어가 있을때 -->
			<when test="keyword != null and keyword != ''">
				<choose>
					<!-- 카테고리1값이 '전체'이거나 공백일때 -->
					<when test="'전체'.equals( searchType1 ) or searchType1 == null or searchType1 == ''">
						<choose>
							<!-- 카테고리2값이 '전체'or 공백일때 -->
							<when test="'전체'.equals( searchType2 ) or searchType2 == null or searchType2 == ''">
								where product_name LIKE CONCAT('%', #{keyword}, '%')
							</when>

							<!-- 카테고리2값이 '전체'아닐때 -->
							<otherwise>
								where
								category = #{searchType2}
								and product_name LIKE CONCAT('%', #{keyword}, '%')
							</otherwise>
						</choose>
					</when>
					
					<!-- 카테고리1값이 '전체' 아닐때 -->
					<otherwise>
						<choose>
							<!-- 카테고리2값이 '전체'or 공백일때 -->
							<when test="'전체'.equals( searchType2 ) or searchType2 == null or searchType2 == ''">
								where
								pet_type = #{searchType1}
								and product_name LIKE CONCAT('%', #{keyword}, '%')
							</when>

							<!-- 카테고리2값이 '전체'아닐때 -->
							<otherwise>
								where
								category = #{searchType2}
								and pet_type = #{searchType1}
								and product_name LIKE CONCAT('%', #{keyword}, '%')
							</otherwise>
						</choose>
					</otherwise>
				</choose>
			</when>

			<!-- 검색어 없을때 -->
			<otherwise>
				<choose>
					<!-- 카테고리1값이 '전체'일때 -->
					<when test="'전체'.equals( searchType1 ) or searchType1 == null or searchType1 == ''">
						<choose>
							<!-- 카테고리2값이 '전체'일때 -->
							<when test="'전체'.equals( searchType2 ) or searchType2 == null or searchType2 == ''">
							</when>

							<!-- 카테고리2값이 '전체' 아닐때 -->
							<otherwise>
								where
								category = #{searchType2}							
							</otherwise>
						</choose>
					</when>

					<!-- 카테고리1값이 '전체' 아닐때 -->
					<otherwise>
						<choose>
							<!-- 카테고리2값이 '전체' 아닐때 -->
							<when test="'전체'.equals( searchType2 ) or searchType2 == null or searchType2 == ''">
								where
								pet_type = #{searchType1}
							</when>

							<!-- 카테고리2값이 '전체'일때 -->
							<otherwise>
								where
								category = #{searchType2}
								and pet_type = #{searchType1}
							</otherwise>
						</choose>
					</otherwise>
				</choose>
			</otherwise>
		</choose>
	</select>
	<!-- ▲▲▲▲Pagination▲▲▲▲ -->

</mapper>